<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Какая программа управляет твоей жизнью?</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- НАСТРОЙКИ ДИЗАЙНА (CSS) --- */
        :root {
            --bg-color: #F5F7FA;        
            --text-color: #1A202C;      
            --accent-color: #0066FF;    
            --orange-color: #FF8C00;    
            --secondary-accent: #718096;
            --white: #FFFFFF;           
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08); 
            --border-radius: 20px;      
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--bg-color); color: var(--text-color); line-height: 1.5; -webkit-font-smoothing: antialiased; }

        .container { max-width: 800px; margin: 0 auto; padding: 40px 20px; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; }

        h1 { font-weight: 800; font-size: 28px; text-align: center; text-transform: uppercase; margin-bottom: 15px; line-height: 1.3; }
        .subtitle { text-align: center; font-size: 18px; font-weight: 600; margin-bottom: 10px; }
        .description { text-align: center; font-size: 14px; color: var(--secondary-accent); margin-bottom: 40px; }
        
        /* Карточки */
        .card { background: var(--white); border-radius: var(--border-radius); padding: 25px 30px; box-shadow: var(--shadow); margin-bottom: 25px; cursor: pointer; transition: all 0.2s ease; position: relative; overflow: hidden; display: flex; flex-direction: column; border: 2px solid transparent; }
        .card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.12); }
        .card-full { border: 3px solid var(--accent-color); } 
        .card-express .card-title { color: var(--orange-color); }
        .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 15px; }
        .card-title { font-size: 24px; font-weight: 800; color: var(--accent-color); line-height: 1.2; }
        
        .badge-info { font-size: 13px; font-weight: 700; padding: 6px 12px; border-radius: 8px; background-color: #EDF2F7; color: var(--text-color); white-space: nowrap; margin-left: 10px; }
        .card-full .badge-info { background-color: rgba(0, 102, 255, 0.1); color: var(--accent-color); }
        .card-express .badge-info { background-color: rgba(255, 140, 0, 0.1); color: var(--orange-color); }
        
        .card-text { font-size: 15px; margin-bottom: 20px; color: #4A5568; line-height: 1.6; }
        
        .card-footer { display: flex; justify-content: space-between; align-items: center; font-size: 14px; font-weight: 700; margin-top: auto; width: 100%; }
        
        .tag { background-color: var(--accent-color); color: white; padding: 6px 14px; border-radius: 20px; font-size: 12px; font-weight: 600; white-space: nowrap; }
        
        .accuracy-badge { font-weight: 700; font-size: 14px; display: flex; align-items: center; }
        .card-full .accuracy-badge { color: var(--accent-color); }
        .card-express .accuracy-badge { color: var(--orange-color); }

        /* Тест */
        .quiz-wrapper { width: 100%; margin: 0 auto; }
        .progress-container { margin-bottom: 30px; width: 100%; margin-left: auto; margin-right: auto; }
        .progress-header { display: flex; justify-content: space-between; font-size: 12px; color: var(--secondary-accent); margin-bottom: 8px; font-weight: 700; text-transform: uppercase; }
        .progress-bar { width: 100%; height: 6px; background-color: #E2E8F0; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background-color: var(--accent-color); width: 0%; transition: width 0.3s ease; }
        .question-card { background: var(--white); padding: 40px 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); text-align: center; margin-bottom: 20px; min-height: 200px; display: flex; align-items: center; justify-content: center; width: 100%; }
        .question-text { font-size: 22px; font-weight: 700; color: var(--text-color); line-height: 1.4; }
        
        .answers-container { display: flex; flex-direction: column; gap: 15px; width: 100%; }
        .btn-answer { padding: 20px; border: none; border-radius: 15px; font-family: 'Montserrat', sans-serif; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.2s; outline: none; width: 100%; }
        
        .btn-yes { background-color: var(--accent-color); color: white; box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3); }
        .btn-yes:active { transform: scale(0.98); }
        .btn-maybe { background-color: var(--white); color: var(--text-color); border: 2px solid #E2E8F0; }
        .btn-maybe:active { background-color: #f7f9fc; }
        .btn-no { background-color: var(--white); color: #A0AEC0; border: 1px solid transparent; }
        .btn-no:active { color: var(--text-color); }

        /* Результаты */
        .chart-section { background: var(--white); border-radius: var(--border-radius); padding: 30px; box-shadow: var(--shadow); margin-bottom: 30px; display: flex; flex-wrap: wrap; align-items: center; justify-content: center; }
        .chart-container { position: relative; width: 300px; height: 300px; }
        .chart-legend { margin-left: 30px; flex: 1; min-width: 250px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #EDF2F7; }
        .legend-item:last-child { border-bottom: none; }
        .legend-color { width: 12px; height: 12px; border-radius: 50%; margin-right: 15px; }
        .legend-text { font-weight: 700; font-size: 16px; color: var(--text-color); display: flex; justify-content: space-between; width: 100%; }
        .legend-score { color: var(--secondary-accent); font-weight: 500; background: #F7FAFC; padding: 2px 8px; border-radius: 8px; font-size: 14px; }
        
        .result-header-card { background: #1A202C; color: white; border-radius: var(--border-radius); padding: 40px 30px; margin-bottom: 20px; text-align: center; box-shadow: var(--shadow); }
        .result-title-small { font-size: 12px; text-transform: uppercase; letter-spacing: 1.5px; opacity: 0.7; margin-bottom: 15px; font-weight: 600; }
        .result-main-name { font-size: 32px; font-weight: 800; text-transform: uppercase; line-height: 1.2; }
        
        .result-body-card { background: var(--white); border-radius: var(--border-radius); padding: 30px; box-shadow: var(--shadow); margin-bottom: 30px; text-align: left; }
        .result-details { font-size: 15px; color: var(--text-color); line-height: 1.6; }
        .detail-block { margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid #EDF2F7; }
        .detail-block:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
        .detail-label { font-weight: 800; color: var(--accent-color); margin-bottom: 5px; display: block; font-size: 16px; text-transform: uppercase; letter-spacing: 0.5px; }

        .long-text-toggle { text-align: center; margin: 20px 0; cursor: pointer; color: var(--accent-color); font-weight: 600; text-decoration: underline; }
        .long-text-content { display: none; background: white; padding: 30px; border-radius: var(--border-radius); margin-bottom: 30px; font-size: 16px; line-height: 1.6; color: var(--text-color); box-shadow: var(--shadow); }
        .long-text-content.visible { display: block; }
        /* Контент длинного текста - форматирование */
        #long-text-container h3 { text-align: center; color: var(--accent-color); margin-bottom: 20px; }
        #long-text-container p { margin-bottom: 15px; }
        #long-text-container ul { margin-bottom: 15px; padding-left: 20px; }
        #long-text-container li { margin-bottom: 5px; }

        .cta-section { text-align: center; margin-top: 40px; margin-bottom: 60px; }
        .cta-text { font-size: 18px; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .arrow-icon { width: 24px; height: 24px; fill: var(--text-color); animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 20%, 50%, 80%, 100% {transform: translateY(0);} 40% {transform: translateY(-5px);} 60% {transform: translateY(-3px);} }
        .btn-cta { background-color: var(--accent-color); color: #FFFFFF !important; padding: 22px 45px; border-radius: 50px; text-decoration: none; font-weight: 800; font-size: 18px; display: inline-block; box-shadow: 0 10px 25px rgba(0, 102, 255, 0.4); transition: transform 0.2s, box-shadow 0.2s; border: none; cursor: pointer; letter-spacing: 0.5px; text-transform: uppercase; }
        .btn-cta:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(0, 102, 255, 0.5); }
        
        .hidden { display: none !important; }
        #warning-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(26, 32, 44, 0.95); z-index: 1000; display: flex; justify-content: center; align-items: center; color: white; text-align: center; padding: 20px; opacity: 0; visibility: hidden; transition: opacity 0.5s ease; }
        #warning-overlay.active { opacity: 1; visibility: visible; }
        .warning-text { font-size: 24px; font-weight: 600; text-transform: uppercase; line-height: 1.5; max-width: 600px; }

        @media (max-width: 600px) {
            h1 { font-size: 24px; }
            .question-text { font-size: 18px; }
            .chart-section { flex-direction: column; padding: 20px; }
            .chart-legend { margin-left: 0; margin-top: 30px; width: 100%; }
            .chart-container { width: 250px; height: 250px; }
            .result-main-name { font-size: 24px; }
            .result-header-card { padding: 30px 20px; }
            .result-body-card { padding: 25px 20px; }
            .card-title { font-size: 20px; }
            .card-footer { justify-content: space-between; flex-wrap: nowrap; align-items: center; }
            .accuracy-badge .badge-info, .tag { font-size: 11px; padding: 6px 10px; white-space: nowrap; }
            .accuracy-badge { width: auto; margin-bottom: 0; justify-content: flex-start; }
            .tag { margin-left: 0; }
        }
    </style>
</head>
<body>

<div id="app" class="container">
    
    <div id="home-page">
        <h1>Какая программа управляет твоей жизнью?</h1>
        <div class="subtitle">Тест на скрытую «Эго-конструкцию». Узнай, что водит тебя по кругу, создает фоновую тревогу и забирает до 80% энергии на внутреннюю борьбу.</div>
        <div class="description">Основано на нейрофизиологии и моделях поведения.</div>

        <h3 style="text-align:center; font-size: 14px; font-weight: 700; margin: 30px 0 20px; text-transform: uppercase;">Выбери глубину сканирования</h3>

        <div class="card card-full" onclick="startTest('full')">
            <div class="card-header">
                <span class="card-title">Полный тест</span>
                <span class="badge-info">~7 мин.</span>
            </div>
            <div class="card-text">
                Глубокий анализ ЭГО-программ. Ты увидишь слепые зоны, которые блокируют твою энергию, здоровый сон и вкус жизни.
            </div>
            <div class="card-footer">
                <span class="accuracy-badge"><span class="badge-info" style="margin-left:0; font-weight:700;">Точность ~95%</span></span>
                <span class="tag">Выбор 84% пользователей</span>
            </div>
        </div>

        <div class="card card-express" onclick="startTest('express')">
            <div class="card-header">
                <span class="card-title">Экспресс-тест</span>
                <span class="badge-info">~3 мин.</span>
            </div>
            <div class="card-text">
                Быстрая диагностика текущего состояния. Узнай, какая программа активна прямо сейчас.
            </div>
            <div class="card-footer">
                <span class="accuracy-badge"><span class="badge-info" style="margin-left:0; font-weight:700;">Точность ~60%</span></span>
            </div>
        </div>
    </div>

    <div id="quiz-page" class="hidden">
        <div class="progress-container">
            <div class="progress-header">
                <span>Прогресс</span>
                <span id="question-counter">1 / 102</span>
            </div>
            <div class="progress-bar">
                <div id="progress-fill" class="progress-fill"></div>
            </div>
        </div>

        <div class="quiz-wrapper">
            <div class="question-card">
                <div id="question-text" class="question-text">Загрузка вопроса...</div>
            </div>

            <div class="answers-container">
                <button class="btn-answer btn-yes" onclick="handleAnswer(3)">Да, это про меня</button>
                <button class="btn-answer btn-maybe" onclick="handleAnswer(1)">Возможно, иногда</button>
                <button class="btn-answer btn-no" onclick="handleAnswer(0)">Нет, не похоже</button>
            </div>
        </div>
    </div>

    <div id="results-page" class="hidden">
        <h1>Результаты тестирования</h1>
        
        <div class="chart-section">
            <div class="chart-container">
                <canvas id="resultsChart"></canvas>
            </div>
            <div class="chart-legend" id="chart-legend"></div>
        </div>

        <div class="result-header-card">
            <div class="result-title-small">Твоя доминирующая программа</div>
            <div id="winner-name" class="result-main-name">НАЗВАНИЕ</div>
        </div>

        <div class="result-body-card">
            <div id="winner-description" class="result-details"></div>
        </div>

        <div class="long-text-toggle" onclick="toggleLongText()">
            Показать подробное описание программы ▼
        </div>
        
        <div id="long-text-block" class="long-text-content">
            <div id="long-text-container">
                <p style="text-align: center; color: #718096;">Загрузка описания...</p>
            </div>
        </div>

        <div class="cta-section">
            <div class="cta-text">
                Жми на кнопку ниже, чтобы узнать решение
                <svg class="arrow-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 16L6 10H18L12 16Z"/>
                </svg>
            </div>
            <a href="https://aleksskorolev.ru/master-class" class="btn-cta">ПОЛУЧИТЬ РЕШЕНИЕ</a>
        </div>
    </div>

</div>

<div id="warning-overlay">
    <div class="warning-text">ОТВЕЧАЙ ЧЕСТНО.<br>ЭТО РАДИ ТЕБЯ.<br>НИКТО НЕ УВИДИТ.</div>
</div>

<script src="descriptions.js" defer></script>

<script>
    const EGO_TYPES = {
        PERFECTIONIST: { id: 1, name: "Перфекционист", color: "#0066FF" },
        WORKAHOLIC: { id: 2, name: "Трудоголик", color: "#0052CC" },
        PROCRASTINATOR: { id: 3, name: "Прокрастинатор", color: "#003D99" },
        NARCISSIST: { id: 4, name: "Нарцисс", color: "#1A202C" },
        VICTIM: { id: 5, name: "Жертва", color: "#2D3748" },
        COMPLICATOR: { id: 6, name: "Усложнятор", color: "#4A5568" },
        RADICALIST: { id: 7, name: "Радикалист", color: "#718096" },
        GOOD_BOY: { id: 8, name: "Хороший Мальчик/Девочка", color: "#0066FF" },
        SKEPTIC: { id: 9, name: "Скептик", color: "#0052CC" },
        ARTIST: { id: 10, name: "Непризнанный Художник", color: "#003D99" },
        CONTROLLER: { id: 11, name: "Контролер", color: "#1A202C" },
        REBEL: { id: 12, name: "Бунтарь", color: "#2D3748" },
        RESCUER: { id: 13, name: "Спасатель", color: "#4A5568" },
        FLY_AWAY: { id: 14, name: "Отлетевший", color: "#718096" },
        JUDGE: { id: 15, name: "Судья (Критик)", color: "#0066FF" },
        INVISIBLE: { id: 16, name: "Невидимка", color: "#0052CC" },
        CYNIC: { id: 17, name: "Циник", color: "#003D99" }
    };

    const SHORT_DESCRIPTIONS = {
        1: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты либо делаешь идеально, либо не делаешь никак.</div>`,
        2: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты чувствуешь вину, когда просто сидишь на диване.</div>`,
        3: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты живешь в иллюзии «завтрашнего дня».</div>`,
        4: `<div class="detail-block"><span class="detail-label">Суть:</span>Твоя самооценка скачет от «Я Бог» до «Я Ничтожество».</div>`,
        5: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты чувствуешь, что жизнь несправедлива.</div>`,
        6: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты генерируешь проблемы, чтобы их героически решать.</div>`,
        7: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты живешь в режиме «Сжечь мосты».</div>`,
        8: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты профессиональный хамелеон. Предаешь себя, лишь бы не обидеть других.</div>`,
        9: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты парализован анализом. Ищешь подвох даже там, где его нет.</div>`,
        10: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты упиваешься своей уникальностью и страданиями.</div>`,
        11: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты живешь в фоновой тревоге: «Если я расслаблюсь, всё рухнет».</div>`,
        12: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты всегда «ПРОТИВ». Твоя жизнь — это борьба с системой.</div>`,
        13: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты живешь чужими проблемами, чтобы не решать свои.</div>`,
        14: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты сбежал из реальности в духовность или фантазии.</div>`,
        15: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты смотришь на мир свысока через призму «Правильно/Неправильно».</div>`,
        16: `<div class="detail-block"><span class="detail-label">Суть:</span>Твоя стратегия — «не отсвечивать».</div>`,
        17: `<div class="detail-block"><span class="detail-label">Суть:</span>Ты надел броню безразличия и сарказма, чтобы тебе не сделали больно.</div>`
    };

    const RAW_QUESTIONS = [
        { type: 1, text: "Я не могу выложить пост или отправить сообщение, пока не проверю все 10 раз." },
        { type: 1, text: "Мне проще сделать всё самому, чем объяснять кому-то, а потом переделывать за ними их косяки." },
        { type: 1, text: "У меня лежат проекты, готовые на 90%, но я их не выпускаю месяцами, потому что хочу «еще немного докрутить»." },
        { type: 1, text: "Меня реально бесит, когда я вижу ошибки или кривое форматирование в чужих текстах." },
        { type: 1, text: "Если делать уборку в квартире, то капитально." },
        { type: 1, text: "Меня раздражает, когда люди делают работу «на отвали»." },

        { type: 2, text: "Если в понедельник вместо работы я решу посмотреть сериал, то меня начнет грызть чувство вины." },
        { type: 2, text: "Для меня самый большой кайф это увидеть в конце дня список задач, где всё вычеркнуто." },
        { type: 2, text: "Я постоянно думаю о задачах/проектах даже когда я в отпуске." },
        { type: 2, text: "Меня бесят ленивые люди." },
        { type: 2, text: "Когда я смотрю фильм, я могу параллельно отвечать в чатах или проверять почту." },
        { type: 2, text: "Меня до бешенства доводит медленный интернет или зависшее приложение." },

        { type: 3, text: "Я скупаю курсы или сохраняю видео «на потом», но так ничего с этим и не делаю." },
        { type: 3, text: "Я постоянно обещаю себе: «Всё, с понедельника точно начну», но ничего не меняется." },
        { type: 3, text: "Вечером я часто ругаю себя за то, что опять профукал день в телефоне." },
        { type: 3, text: "Я жду «особого настроения» или вдохновения, чтобы начать делать." },
        { type: 3, text: "Я люблю покупать красивые блокноты и расписывать планы, но обычно этим и заканчивается." },
        { type: 3, text: "У меня куча идей, которые лежат мертвым грузом." },

        { type: 4, text: "Меня реально бесит, когда я вижу, как откровенные тупицы поднимают миллионы, а я сижу в тени." },
        { type: 4, text: "Если мое фото/пост в соцсетях набрало мало лайков, я хочу его удалить." },
        { type: 4, text: "В моей жизни все не так «красиво», как я рассказываю друзьям или в соц. сетях." },
        { type: 4, text: "Когда у «успешных» людей случается провал, я чувствую тайное облегчение." },
        { type: 4, text: "Я не выхожу на улицу без марафета. Мне важно выглядеть достойно." },
        { type: 4, text: "Я часто в голове веду воображаемые диалоги, где я круто отвечаю хейтерам." },

        { type: 5, text: "Меня бесят советы в стиле «Просто возьми и сделай»." },
        { type: 5, text: "Я искренне не понимаю, почему другим всё падает с неба, а мне приходится выгрызать каждый сантиметр." },
        { type: 5, text: "Если бы у меня были богатые родители или связи, я бы уже давно был(а) на вершине." },
        { type: 5, text: "Иногда хочется просто сесть и заплакать от бессилия." },
        { type: 5, text: "Я жду, что начальник сам заметит мои старания и повысит зарплату." },
        { type: 5, text: "Когда я вижу успешного блогера, первая мысль: «Ну конечно, ему родители помогли»." },

        { type: 6, text: "Терпеть не могу советы в духе «просто иди и сделай»." },
        { type: 6, text: "Я могу днями собирать прототип проекта, но к самой работе так и не приступлю." },
        { type: 6, text: "Я не понимаю людей, которые говорят «Просто я так чувствую». Мне нужны факты." },
        { type: 6, text: "Я не могу просто взять и запустить проект, мне сначала нужно собрать схему." },
        { type: 6, text: "Меня бесят люди которые громко смеются или рыдают напоказ." },
        { type: 6, text: "Я не люблю поверхностный подход. Мне хочется сделать что-то фундаментальное." },

        { type: 7, text: "Я часто начинаю «новую жизнь» с понедельника и быстро бросаю." },
        { type: 7, text: "Меня тошнит от спокойной, размеренной жизни «дом-работа-дом»." },
        { type: 7, text: "Мысль о том, что я буду жить в одной квартире 10 лет, вызывает у меня приступ удушья." },
        { type: 7, text: "Иногда мне хочется просто бросить всё к чертям и уехать в глушь." },
        { type: 7, text: "Я часто смотрю билеты на самолет «просто так»." },
        { type: 7, text: "У меня два режима: либо я пашу как терминатор, либо я лежу пластом." },

        { type: 8, text: "Если мне принесли невкусную еду, я скорее съем её молча, чем позову официанта." },
        { type: 8, text: "Мне сложно отказывать, поэтому я часто соглашаюсь на неудобные условия." },
        { type: 8, text: "Даже, если я вижу, что человек мне врет я не буду ему этим тыкать в лицо." },
        { type: 8, text: "Мне проще простить долг, чем звонить и напоминать о деньгах." },
        { type: 8, text: "После разговора я часто думаю: «Блин, надо было ему ответить вот так!»." },
        { type: 8, text: "Если близкий человек ходит с недовольным лицом, меня накрывает тревога." },

        { type: 9, text: "Когда я слышу про «легкий заработок», я сразу думаю: «Развод для лохов»." },
        { type: 9, text: "Меня дико раздражают слишком позитивные люди." },
        { type: 9, text: "Я считаю, что большинство психологов и коучей это инфоцыгане." },
        { type: 9, text: "Когда я вижу романтические признания в соцсетях, меня тянет блевать." },
        { type: 9, text: "Прежде чем что-то купить, я буду час гуглить негативные отзывы." },
        { type: 9, text: "Я получаю удовольствие, когда нахожу ошибку у какого-то «гуру»." },

        { type: 10, text: "Меня воротит от слова «продажи» и «прогревы»." },
        { type: 10, text: "Мне обидно видеть, как люди сходят с ума по мусору, а стоящее никому не нужно." },
        { type: 10, text: "У меня есть ощущение, что если я начну гоняться за деньгами, то продам душу." },
        { type: 10, text: "Мне кажется, что мои идеи слишком сложные для большинства людей." },
        { type: 10, text: "Я смотрю на популярных экспертов и не понимаю: как можно восхищаться такой посредственностью?" },
        { type: 10, text: "Мне кажется, что деньги и настоящее творчество несовместимые." },

        { type: 11, text: "Я не могу смотреть, как другие моют посуду «неправильно». Проще сделать самому." },
        { type: 11, text: "Я часто ловлю себя на мысли: «Господи, если я сейчас умру, они же тут все пропадут»." },
        { type: 11, text: "Меня бесит, когда люди опаздывают." },
        { type: 11, text: "Я прошу близких: «Напиши, как доедешь», а если не пишут, я начинаю паниковать." },
        { type: 11, text: "Перед выходом из дома я возвращаюсь проверить утюг/дверь. Иногда дважды." },
        { type: 11, text: "Даже в отпуске я держу руку на пульсе: всё должно быть под контролем." },

        { type: 12, text: "Как только мне говорят «надо», я сразу хочу сделать наоборот." },
        { type: 12, text: "Я ненавижу графики и жесткие рамки." },
        { type: 12, text: "Когда начальник или «гуру» начинает учить меня жизни, мне хочется послать его." },
        { type: 12, text: "Мне сложно работать в найме, потому что я не переношу, когда мною командуют." },
        { type: 12, text: "Я считаю, что правила придуманы для дураков." },
        { type: 12, text: "Я часто опаздываю или нарушаю правила просто потому, что нутро сопротивляется." },

        { type: 13, text: "Я часто чувствую себя помойкой: все сливают на меня проблемы." },
        { type: 13, text: "Меня обижает, когда я выворачиваюсь наизнанку, а мне даже «спасибо» не скажут." },
        { type: 13, text: "Я трачу кучу времени, разгребая чужие проблемы." },
        { type: 13, text: "Я даю деньги в долг, хотя у самого впритык, потому что «ему нужнее»." },
        { type: 13, text: "Мне больно смотреть, как другие мучаются и хочется помочь." },
        { type: 13, text: "Я часто думаю: «Почему я для них всё, а они этого не ценят»." },

        { type: 14, text: "Я не парюсь о деньгах, я верю, что «Вселенная позаботится»." },
        { type: 14, text: "Меня раздражают разговоры про налоги и бытовуху — это «низкие вибрации»." },
        { type: 14, text: "Все мои проблемы: «Это просто мой кармический урок»." },
        { type: 14, text: "Меня раздражают «неосознанные» люди (мясоеды, офисные работники)." },
        { type: 14, text: "Я считаю, что работать на обычной работе — это рабство." },
        { type: 14, text: "Мне сложно принять решение без астрологии или ТАРО." },

        { type: 15, text: "Меня бесят современные тренды. Мир катится в пропасть." },
        { type: 15, text: "Я часто читаю комментарии, просто чтобы побомбить с того, какие люди тупые." },
        { type: 15, text: "Меня трясет, когда я вижу как быдло лезет без очереди." },
        { type: 15, text: "Меня раздражает человеческая глупость." },
        { type: 15, text: "Вера в человечество? Люди — это эгоистичные существа." },
        { type: 15, text: "Я не могу промолчать, если вижу, что кто-то неправ." },

        { type: 16, text: "Я часто пишу комментарий, думаю «Да кому это интересно?» и стираю." },
        { type: 16, text: "Когда меня спрашивают «сколько стоит?», я смущаюсь и называю цену ниже." },
        { type: 16, text: "Я не завожу блог, потому что мне нечего особенного дать миру." },
        { type: 16, text: "В Zoom я всегда сижу с выключенной камерой." },
        { type: 16, text: "Я ненавижу фотографироваться." },
        { type: 16, text: "Когда меня хвалят, я говорю: «Ой, да ничего особенного»." },

        { type: 17, text: "Если человек делает добро — он либо хочет что-то взамен, либо тешит самолюбие." },
        { type: 17, text: "Счастливые семьи — это миф. Всё заканчивается изменами или скукой." },
        { type: 17, text: "Не делай добра — не получишь зла." },
        { type: 17, text: "Лучше посмеяться над проблемой, чем разводить нытье." },
        { type: 17, text: "Мир прогнил. Кругом лицемеры." },
        { type: 17, text: "Когда кто-то проявляет заботу, я ищу подвох: «Что тебе надо?»" }
    ];

    let currentQuestions = [];
    let currentQuestionIndex = 0;
    let scores = {};
    let currentWinnerId = null;

    function initScores() {
        for (let i = 1; i <= 17; i++) {
            scores[i] = 0;
        }
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function prepareQuestions(mode) {
        initScores();
        let finalQuestions = [];

        if (mode === 'full') {
            finalQuestions = [...RAW_QUESTIONS];
        } else {
            for (let i = 1; i <= 17; i++) {
                const typeQuestions = RAW_QUESTIONS.filter(q => q.type === i);
                const shuffled = shuffleArray([...typeQuestions]);
                finalQuestions.push(...shuffled.slice(0, 3));
            }
        }
        currentQuestions = shuffleArray(finalQuestions);
        currentQuestionIndex = 0;
    }

    function startTest(mode) {
        const overlay = document.getElementById('warning-overlay');
        overlay.classList.add('active');

        prepareQuestions(mode);

        setTimeout(() => {
            overlay.classList.remove('active');
            document.getElementById('home-page').classList.add('hidden');
            document.getElementById('quiz-page').classList.remove('hidden');
            renderQuestion();
        }, 3000);
    }

    function renderQuestion() {
        const q = currentQuestions[currentQuestionIndex];
        const counterEl = document.getElementById('question-counter');
        const textEl = document.getElementById('question-text');
        const fillEl = document.getElementById('progress-fill');

        textEl.innerText = q.text;
        counterEl.innerText = `${currentQuestionIndex + 1} / ${currentQuestions.length}`;
        const percent = ((currentQuestionIndex) / currentQuestions.length) * 100;
        fillEl.style.width = `${percent}%`;

        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function handleAnswer(points) {
        const q = currentQuestions[currentQuestionIndex];
        scores[q.type] += points;
        currentQuestionIndex++;
        if (currentQuestionIndex < currentQuestions.length) {
            renderQuestion();
        } else {
            finishTest();
        }
    }

    function finishTest() {
        document.getElementById('quiz-page').classList.add('hidden');
        document.getElementById('results-page').classList.remove('hidden');
        window.scrollTo(0,0);

        const resultsArray = Object.keys(scores).map(typeId => {
            const id = parseInt(typeId);
            return {
                id: id,
                score: scores[id],
                name: EGO_TYPES[Object.keys(EGO_TYPES).find(key => EGO_TYPES[key].id === id)].name,
                color: EGO_TYPES[Object.keys(EGO_TYPES).find(key => EGO_TYPES[key].id === id)].color
            };
        });

        resultsArray.sort((a, b) => b.score - a.score);

        const winner = resultsArray[0];
        currentWinnerId = winner.id;
        
        document.getElementById('winner-name').innerText = winner.name;
        
        // Подгружаем краткое описание из локального объекта
        if(SHORT_DESCRIPTIONS[winner.id]) {
             document.getElementById('winner-description').innerHTML = SHORT_DESCRIPTIONS[winner.id];
        } else {
             document.getElementById('winner-description').innerHTML = "<p>Описание формируется...</p>";
        }

        const top3 = resultsArray.slice(0, 3);
        drawChart(top3);
        renderLegend(top3);
    }

    function drawChart(top3Data) {
        const ctx = document.getElementById('resultsChart').getContext('2d');
        
        new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: top3Data.map(i => i.name),
                datasets: [{
                    data: top3Data.map(i => i.score),
                    backgroundColor: ['#0066FF', '#0044AA', '#002255'],
                    borderWidth: 0,
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                cutout: '65%',
                plugins: {
                    legend: { display: false },
                    tooltip: { enabled: false }
                }
            }
        });
    }

    function renderLegend(top3Data) {
        const legendContainer = document.getElementById('chart-legend');
        const colors = ['#0066FF', '#0044AA', '#002255'];
        
        let html = '';
        top3Data.forEach((item, index) => {
            html += `
                <div class="legend-item">
                    <div class="legend-color" style="background-color: ${colors[index]}"></div>
                    <div class="legend-text">
                        <span>${index + 1}. ${item.name}</span>
                        <span class="legend-score">${item.score} б.</span>
                    </div>
                </div>
            `;
        });
        legendContainer.innerHTML = html;
    }

    // ЛОГИКА ОТКРЫТИЯ ПОДРОБНОГО ОПИСАНИЯ
    function toggleLongText() {
        const block = document.getElementById('long-text-block');
        const container = document.getElementById('long-text-container');
        
        // Если блок еще не открыт
        if (!block.classList.contains('visible')) {
            // Проверяем, загрузилась ли база данных из внешнего файла
            if (window.EGO_FULL_DESCRIPTIONS && window.EGO_FULL_DESCRIPTIONS[currentWinnerId]) {
                container.innerHTML = window.EGO_FULL_DESCRIPTIONS[currentWinnerId];
            } else {
                container.innerHTML = '<p style="text-align:center;">Описание не найдено или файл базы данных (descriptions.js) не подключен.</p>';
            }
        }
        
        block.classList.toggle('visible');
    }
</script>

</body>
</html>
