<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Какая программа управляет твоей жизнью?</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        /* --- ТВОЙ ИЗНАЧАЛЬНЫЙ ДИЗАЙН --- */
        :root {
            --bg-color: #F5F7FA;        
            --text-color: #1A202C;      
            --accent-color: #0066FF;    
            --orange-color: #FF8C00;    
            --secondary-accent: #718096;
            --white: #FFFFFF;           
            --shadow: 0 4px 20px rgba(0, 0, 0, 0.08); 
            --border-radius: 20px;      
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Montserrat', sans-serif; background-color: var(--bg-color); color: var(--text-color); line-height: 1.6; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; }
        .container { background-color: var(--white); width: 100%; max-width: 600px; padding: 40px 30px; border-radius: var(--border-radius); box-shadow: var(--shadow); position: relative; overflow: hidden; }
        h1 { font-size: 24px; font-weight: 800; text-align: center; margin-bottom: 30px; color: var(--accent-color); text-transform: uppercase; letter-spacing: 1px; line-height: 1.2; }
        canvas { margin-bottom: 30px; max-width: 100%; }
        #chart-legend { margin-bottom: 30px; }
        .legend-item { display: flex; align-items: center; margin-bottom: 12px; padding: 12px; background: #F8FAFC; border-radius: 12px; }
        .legend-color { width: 14px; height: 14px; border-radius: 4px; margin-right: 12px; flex-shrink: 0; }
        .legend-text { display: flex; justify-content: space-between; width: 100%; font-size: 14px; font-weight: 600; }
        .legend-score { color: var(--secondary-accent); font-weight: 500; }
        .btn { display: block; width: 100%; padding: 20px; background-color: var(--accent-color); color: var(--white); border: none; border-radius: 15px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; text-transform: uppercase; letter-spacing: 1px; box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3); }
        .btn:hover { background-color: #0052CC; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 102, 255, 0.4); }
        #long-text-block { display: none; margin-top: 35px; padding-top: 35px; border-top: 2px solid #EDF2F7; }
        #long-text-block.visible { display: block; animation: slideIn 0.6s ease-out; }
        #long-text-container h3 { font-size: 22px; color: var(--accent-color); margin-bottom: 20px; font-weight: 800; line-height: 1.3; }
        #long-text-container p { margin-bottom: 15px; font-size: 16px; color: #4A5568; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <h1>Результат теста</h1>
        <canvas id="resultChart"></canvas>
        <div id="chart-legend"></div>
        <button class="btn" id="action-btn" onclick="toggleLongText()">УЗНАТЬ ПОДРОБНЕЕ</button>
        <div id="long-text-block">
            <div id="long-text-container"></div>
        </div>
    </div>

<script>
    /* --- БАЗА ДАННЫХ (ВСЕ 17 ТИПОВ) --- */
    window.EGO_FULL_DESCRIPTIONS = {
        1: `<h3>ПЕРФЕКЦИОНИСТ: Полный разбор</h3><p>Я знаю, как ты живешь. Твой мир — это бесконечный список "как должно быть". Твоя планка всегда на сантиметр выше твоих возможностей...</p>`,
        2: `<h3>ПОМОЩНИК: Полный разбор</h3><p>Ты — тот, кто всегда рядом. Но кто рядом с тобой? Твоя программа заставляет тебя заслуживать любовь через пользу...</p>`,
        3: `<h3>ДОСТИГАТОР: Полный разбор</h3><p>Твоя жизнь — это бег на беговой дорожке. Ты ставишь рекорды, но остаешься на месте в плане внутреннего счастья...</p>`,
        4: `<h3>ИНДИВИДУАЛИСТ: Полный разбор</h3><p>Тебе кажется, что тебя никто не понимает. Твоя программа — это поиск уникальности через страдание...</p>`,
        5: `<h3>МЫСЛИТЕЛЬ: Полный разбор</h3><p>Ты наблюдаешь за жизнью из окна своего разума. Тебе кажется, что если ты всё изучишь, ты будешь в безопасности...</p>`,
        6: `<h3>УСЛОЖНЯТОР: Полный разбор</h3><p>Твой мозг — перегретый процессор. Ты усложняешь простое, чтобы не переходить к действиям...</p>`,
        7: `<h3>ЭНТУЗИАСТ: Полный разбор</h3><p>Ты бежишь за новыми впечатлениями, чтобы не чувствовать внутреннюю пустоту или боль...</p>`,
        8: `<h3>БОСС: Полный разбор</h3><p>Мир для тебя — это борьба. Ты либо контролируешь, либо тебя контролируют. Ты забыл, что такое уязвимость...</p>`,
        9: `<h3>МИРОТВОРЕЦ: Полный разбор</h3><p>Ты готов на всё, лишь бы не было конфликта. Но цена этого мира — твоя собственная жизнь и желания...</p>`,
        10: `<h3>СКЕПТИК: Полный разбор</h3><p>Ты видишь подвох везде. Твоя бдительность защищает тебя, но она же лишает тебя возможности доверять...</p>`,
        11: `<h3>КОНТРОЛЕР: Полный разбор</h3><p>Я знаю, как ты устал всё держать. Ты — единственный взрослый в горящем детском саду. Но если ты отпустишь — ничего не рухнет...</p>`,
        12: `<h3>ЖЕРТВА: Полный разбор</h3><p>Твоя стратегия — привлекать внимание через слабость. Это дает бонусы, но лишает тебя настоящей силы...</p>`,
        13: `<h3>КРИТИК: Полный разбор</h3><p>Твой внутренний голос — самый суровый судья. Он не дает тебе дышать и пробовать новое...</p>`,
        14: `<h3>СПАСАТЕЛЬ: Полный разбор</h3><p>Ты решаешь чужие проблемы, чтобы не смотреть в свои. Твоя значимость зависит от того, насколько ты нужен другим...</p>`,
        15: `<h3>ТРУДОГОЛИК: Полный разбор</h3><p>Ты прячешься в делах от чувств. Твоя ценность для тебя равна твоей продуктивности...</p>`,
        16: `<h3>РОМАНТИК: Полный разбор</h3><p>Ты живешь в ожидании чуда или идеального момента, пропуская реальную жизнь прямо сейчас...</p>`,
        17: `<h3>ИДЕАЛИСТ: Полный разбор</h3><p>Ты хочешь изменить мир, но не можешь принять его несовершенство. Это порождает вечный гнев...</p>`
    };

    /* --- ЛОГИКА ТЕСТА (ТВОЯ РОДНАЯ) --- */
    // Получаем данные из URL (которые присылает Тильда или форма)
    const urlParams = new URLSearchParams(window.location.search);
    const results = {};
    for (let i = 1; i <= 17; i++) {
        results[i] = parseInt(urlParams.get('e' + i)) || 0;
    }

    const sortedResults = Object.entries(results)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 3);

    const typeNames = {
        1: "Перфекционист", 2: "Помощник", 3: "Достигатор", 4: "Индивидуалист", 5: "Мыслитель",
        6: "Усложнятор", 7: "Энтузиаст", 8: "Босс", 9: "Миротворец", 10: "Скептик",
        11: "Контролер", 12: "Жертва", 13: "Критик", 14: "Спасатель", 15: "Трудоголик",
        16: "Романтик", 17: "Идеалист"
    };

    const currentWinnerId = sortedResults[0][0];

    // Отрисовка графика
    const ctx = document.getElementById('resultChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: sortedResults.map(item => typeNames[item[0]]),
            datasets: [{
                data: sortedResults.map(item => item[1]),
                backgroundColor: ['#0066FF', '#0044AA', '#002255'],
                borderWidth: 0,
                hoverOffset: 10
            }]
        },
        options: {
            cutout: '70%',
            plugins: { legend: { display: false } },
            animation: { animateScale: true, duration: 1000 }
        }
    });

    // Легенда
    const legendContainer = document.getElementById('chart-legend');
    let legendHtml = '';
    sortedResults.forEach((item, index) => {
        const colors = ['#0066FF', '#0044AA', '#002255'];
        legendHtml += `
            <div class="legend-item">
                <div class="legend-color" style="background-color: ${colors[index]}"></div>
                <div class="legend-text">
                    <span>${index + 1}. ${typeNames[item[0]]}</span>
                    <span class="legend-score">${item[1]} б.</span>
                </div>
            </div>
        `;
    });
    legendContainer.innerHTML = legendHtml;

    // Кнопка подробнее
    function toggleLongText() {
        const block = document.getElementById('long-text-block');
        const container = document.getElementById('long-text-container');
        
        if (!block.classList.contains('visible')) {
            container.innerHTML = window.EGO_FULL_DESCRIPTIONS[currentWinnerId] || "Описание скоро будет добавлено.";
        }
        block.classList.toggle('visible');
        
        const btn = document.getElementById('action-btn');
        btn.innerText = block.classList.contains('visible') ? "СВЕРНУТЬ" : "УЗНАТЬ ПОДРОБНЕЕ";
    }
</script>
</body>
</html>
